 const axios = require("axios");
const fs = require("fs");
module.exports.config = {
    name: "cap",
    version: "1.0.0",
    hasPermssion: 0,
    credits: "Thiá»‡u Trung KiÃªn",
    description: "Chá»¥p áº£nh profile cá»§a ngÆ°á»i dÃ¹ng",
    commandCategory: "TIá»†N ÃCH",
    usages: "",
    cooldowns: 5
}
module.exports.handleEvent = async ({ api, event, Threads, args, Users }) => {
  try{
  if(event.body.toLowerCase() == "cap"){
    let name = await Users.getNameUser(event.senderID);
    let mentions = [];
    mentions.push({
      tag: name,
      id: event.senderID
    })
    api.sendMessage({body: `â†’ Ä‘ð—¼Ì›Ì£ð—¶ ð˜ð—¶Ì ð—»ð—µð—® ${name} ð—¯ð—¼ð˜ Ä‘ð—®ð—»ð—´ ð—°ð—®ð—½`, mentions}, event.threadID, event.messageID);
    if (event.type == "message_reply") {
      var uid = event.messageReply.senderID;
    } else if (Object.keys(event.mentions).length == 1) {
      var uid = Object.keys(event.mentions)[0];
    }
  else {
          var uid = event.senderID;
    }
    var cookies = `datr=IW6OYzGR5qmRparkFEtE_Otb; sb=IW6OY21DPXELwn54ALccC3Fo; locale=vi_VN; fr=0Pb36pocAZ1llVtqo.AWWlNb8Ni1sll1xgF_mqVQlc_rY.Bjjm4h.Hx.AAA.0.0.Bjjp4i.AWXK55zoJEg; c_user=100084657540140; xs=9%3A23cLnItv_VBj_g%3A2%3A1670290979%3A-1%3A13078; m_page_voice=100084657540140; fbl_st=101232920%3BT%3A27838183; fbl_cs=AhDUKt8FsTq9wZwjHt0NQZNGGFRiWS90cWpPZng4NDd2b1djNzBvVFZ0Sw; fbl_ci=1160516437932188; vpd=v1%3B675x501x1.4375; m_pixel_ratio=1.4375; wd=502x940; useragent=TW96aWxsYS81LjAgKExpbnV4OyBBbmRyb2lkIDk7IHZpdm8gMTkxNikgQXBwbGVXZWJLaXQvNTM3LjM2IChLSFRNTCwgbGlrZSBHZWNrbykgQ2hyb21lLzEwNy4wLjAuMCBNb2JpbGUgU2FmYXJpLzUzNy4zNg%3D%3D; _uafec=Mozilla%2F5.0%20(Linux%3B%20Android%209%3B%20vivo%201916)%20AppleWebKit%2F537.36%20(KHTML%2C%20like%20Gecko)%20Chrome%2F107.0.0.0%20Mobile%20Safari%2F537.36;`,
    vaildItems = ['sb', 'datr', 'c_user', 'xs', 'm_pixel_ratio', 'locale', 'wd', 'fr', 'presence', 'xs', 'm_page_voice', 'fbl_st', 'fbl_ci', 'fbl_cs', 'vpd', 'wd', 'fr', 'presence'];
    var cookie = `datr=IW6OYzGR5qmRparkFEtE_Otb; sb=IW6OY21DPXELwn54ALccC3Fo; locale=vi_VN; fr=0Pb36pocAZ1llVtqo.AWWlNb8Ni1sll1xgF_mqVQlc_rY.Bjjm4h.Hx.AAA.0.0.Bjjp4i.AWXK55zoJEg; c_user=100084657540140; xs=9%3A23cLnItv_VBj_g%3A2%3A1670290979%3A-1%3A13078; m_page_voice=100084657540140; fbl_st=101232920%3BT%3A27838183; fbl_cs=AhDUKt8FsTq9wZwjHt0NQZNGGFRiWS90cWpPZng4NDd2b1djNzBvVFZ0Sw; fbl_ci=1160516437932188; vpd=v1%3B675x501x1.4375; m_pixel_ratio=1.4375; wd=502x940; useragent=TW96aWxsYS81LjAgKExpbnV4OyBBbmRyb2lkIDk7IHZpdm8gMTkxNikgQXBwbGVXZWJLaXQvNTM3LjM2IChLSFRNTCwgbGlrZSBHZWNrbykgQ2hyb21lLzEwNy4wLjAuMCBNb2JpbGUgU2FmYXJpLzUzNy4zNg%3D%3D; _uafec=Mozilla%2F5.0%20(Linux%3B%20Android%209%3B%20vivo%201916)%20AppleWebKit%2F537.36%20(KHTML%2C%20like%20Gecko)%20Chrome%2F107.0.0.0%20Mobile%20Safari%2F537.36;`;
    cookies.split(';').forEach(item => {
        var data = item.split('=');
        if (vaildItems.includes(data[0])) cookie += `${data[0]}=${data[1]};`;
    });
    var url = encodeURI(encodeURI((`https://trend-trai-tim.hianime.repl.co/screenshot/${uid}/${cookie}`))),
        path = __dirname + `/cache/${uid}.png`;
    axios({
        method: "GET",
        url: `https://api.screenshotmachine.com/?key=a526f9&url=${url}&dimension=1920x1080`,
        responseType: "arraybuffer"
    }).then(res => {
        fs.writeFileSync(path, Buffer.from(res.data, "utf-8"));
        api.sendMessage({body: `====ã€Ž ð—–ð—”ð—£ ð—ªð—”ð—Ÿð—Ÿ ã€====\nâ”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”\nðŸ’ž ð—®Ì‚ð˜† ð—±ð—¼Ì‚ ð—¯ð—¼ð˜ ð—°ð—®ð—½ ð˜…ð—¼ð—»ð—´ ð—¿ð—¼Ì‚Ì€ð—¶ ð—»ð—²Ì€ ${name}\nâ†’ ð˜ð—¶Ìð—»ð—µ ð—»ð—®Ì†ð—»ð—´ ð˜ð˜‚Ì›Ì£ Ä‘ð—¼Ì‚Ì£ð—»ð—´ ð—°ð—®ð—½ ð˜„ð—®ð—¹ð—¹ ð—¸ð—µð—¶ ð—½ð—µð—®Ìð˜ ð—µð—¶ð—²Ì‚Ì£ð—» ð˜ð—¶ð—» ð—»ð—µð—®Ì†Ìð—» ð—°ð—®ð—½`,mentions, attachment: fs.createReadStream(path) }, event.threadID, () => fs.unlinkSync(path), event.messageID);
    }).catch(err => console.log(err));
  }
} catch(e){
    console.log(e)
}}
module.exports.run = async function ({ api,Users,event, args }) {
  let name = await Users.getNameUser(event.senderID);
    let mentions = [];
    mentions.push({
      tag: name,
      id: event.senderID
    })
    api.sendMessage({body: `â†’ Ä‘ð—¼Ì›Ì£ð—¶ ð˜ð—¶Ì ð—»ð—µð—® ${name} ð—¯ð—¼ð˜ Ä‘ð—®ð—»ð—´ ð—°ð—®ð—½`,mentions}, event.threadID, event.messageID);
    var uid = String(args[0]);
    isNaN(uid) && (uid = Object.keys(event.mentions)[0], "message_reply" == event.type ? uid = event.messageReply.senderID : uid = event.senderID);
    var cookies = `sb=XYOFY83lQ7FiCLM4omECYXhh;datr=XoOFYxHnTqLWBsAwek-fIgw-;c_user=100079715251584;wd=1536x754;dpr=1.25;xs=18%3AwSz5tw9a4pWUwg%3A2%3A1669694310%3A-1%3A6279%3A%3AAcWOkNLxP6Mf3gqfoNTeJvn-LkhFHLg2fwB24H4fNII;fr=0Uyj4PhAyvRNWktuZ.AWX9nvgx28ltkEzg4rHw0xxW_BM.Bjneq6.f7.AAA.0.0.Bjnx4D.AWWOg8XOg6Y;|Mozilla/5.0 (Windows NT 6.1; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/107.0.0.0 Safari/537.36`,
    vaildItems = ['sb', 'datr', 'c_user', 'xs', 'm_pixel_ratio', 'locale', 'wd', 'fr', 'presence', 'xs', 'm_page_voice', 'fbl_st', 'fbl_ci', 'fbl_cs', 'vpd', 'wd', 'fr', 'presence'];
    var cookie = `sb=XYOFY83lQ7FiCLM4omECYXhh;datr=XoOFYxHnTqLWBsAwek-fIgw-;c_user=100079715251584;wd=1536x754;dpr=1.25;xs=18%3AwSz5tw9a4pWUwg%3A2%3A1669694310%3A-1%3A6279%3A%3AAcWOkNLxP6Mf3gqfoNTeJvn-LkhFHLg2fwB24H4fNII;fr=0Uyj4PhAyvRNWktuZ.AWX9nvgx28ltkEzg4rHw0xxW_BM.Bjneq6.f7.AAA.0.0.Bjnx4D.AWWOg8XOg6Y;`;
    cookies.split(';').forEach(item => {
        var data = item.split('=');
        if (vaildItems.includes(data[0])) cookie += `${data[0]}=${data[1]};`;
    });
    var url = encodeURI(encodeURI((`https://trend-trai-tim.hianime.repl.co/screenshot/${uid}/${cookie}`))),
        path = __dirname + `/cache/${uid}.png`;
    axios({
        method: "GET",
        url: `https://api.screenshotmachine.com/?key=a526f9&url=${url}&dimension=1920x1080`,
        responseType: "arraybuffer"
    }).then(res => {
        fs.writeFileSync(path, Buffer.from(res.data, "utf-8"));
        api.sendMessage({body: `====ã€Ž ð—–ð—”ð—£ ð—ªð—”ð—Ÿð—Ÿ ã€====\nâ”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”\nðŸ’ž ð—®Ì‚ð˜† ð—±ð—¼Ì‚ ð—¯ð—¼ð˜ ð—°ð—®ð—½ ð˜…ð—¼ð—»ð—´ ð—¿ð—¼Ì‚Ì€ð—¶ ð—»ð—²Ì€ ${name}`,mentions, attachment: fs.createReadStream(path) }, event.threadID, () => fs.unlinkSync(path), event.messageID);
    }).catch(err => console.log(err));
                                                       }